@startuml
title eChemPad – Component Diagram

skinparam componentStyle rectangle
skinparam shadowing false
skinparam wrapWidth 250
skinparam maxMessageSize 200

' -----------------------------------------------------------
' External Systems
' -----------------------------------------------------------
package "External Components" {
    [Dataverse CORA.RDR\n(dataverse.csuc.cat)] as Dataverse
    [Perkin-Elmer Signals Notebook\n(signals.iciq.es)] as Signals
    [ICIQ LDAP\n(ldap.iciq.es)] as LDAP
}

' -----------------------------------------------------------
' Internal Backend Architecture
' -----------------------------------------------------------
package "eChemPad Backend" {

    package "Storage Layer" {
        [PostgreSQL DB\n(app metadata, file metadata)] as PG
        [MinIO\n(file storage)] as MinIO
    }

    package "Authentication" {
        [Apereo CAS] as CAS
    }

    package "Core Services" {
        [Uploader Service\n- Upload via HTTP or MinIO reference] as Uploader
        [Downloader Service\n- Downloads/updates from Signals\n- Conflict detection\n- Merge endpoint] as Downloader
        [DB Service\n- Creates/updates files, journals,\n  experiments using PG + MinIO] as DBService
    }

    [Gateway\n(echempad.iciq.es)\nEntry point + Security] as Gateway
}

' -----------------------------------------------------------
' Frontend Layer
' -----------------------------------------------------------
package "Frontend" {
    [Front-End App\n(React)] as FEApp
    [Front-End Form\n(Microsoft Forms)] as FEForm
}

' -----------------------------------------------------------
' Connections
' -----------------------------------------------------------

' Frontends → Gateway
FEApp --> Gateway : API requests
FEForm --> Gateway : Upload journal to Dataverse

' Gateway → Core Services
Gateway --> Uploader
Gateway --> Downloader
Gateway --> DBService
Gateway --> CAS : authentication request

' CAS → LDAP
CAS --> LDAP : validate credentials\nfetch researcher profile

' Core Services → Storage
Uploader --> MinIO : store file
Uploader --> PG : store file metadata

DBService --> PG : metadata operations
DBService --> MinIO : manage file objects

' Downloader → External Signals
Downloader --> Signals : download journals / experiments\nwith reference ID

' Downloader → Storage
Downloader --> MinIO : save downloaded files
Downloader --> PG : store/update metadata\ncheck conflicts

' Uploader/Downloader → Dataverse
Uploader --> Dataverse : upload dataset (optional)
Downloader --> Dataverse : update dataset (optional)

@enduml

