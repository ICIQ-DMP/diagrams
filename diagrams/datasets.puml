@startuml
title Research Data Ecosystem – Catalunya (Simplified Relations, Updated)

skinparam componentStyle rectangle
skinparam shadowing false
skinparam wrapWidth 250

' --------------------------------------------------------
' Platforms
' --------------------------------------------------------

package "Institutional Systems" {
    [iMarina\nInstitutional CRIS\nStores publications, datasets (partial)\nDepends on ORCID] as iMarina
}

package "Data Repositories" {
    [ioChem-BD\nComputational Chemistry Datasets\nCan push datasets to iMarina] as ioChem
    [CORA.RDR\nDataverse installation\nPrimary dataset repository feeding PRC] as CORA_RDR
    [CORA.TDX\nTheses Repository] as CORA_TDX
    [Recercat\nOpen-access institutional repository] as Recercat
    [eiNa.DMP\nData Management Plans repository\nShould include ORCID] as eiNa
}

package "Aggregators / Harvesters" {
    [PRC / RDR\nPortal de la Recerca de Catalunya\nAggregates researchers + datasets from multiple sources\nRequires ORCID for linkage] as PRC
}

' --------------------------------------------------------
' Relations (simplified)
' --------------------------------------------------------

' --- Institutional CRIS flows ---
iMarina --> PRC : Researcher profiles\n(ORCID mandatory)
iMarina --> PRC : Publications\n(Currently loaded via CRIS feed)

' --- Datasets from ioChemBD ---
ioChem --> iMarina : Push datasets\n(metadata, files)
iMarina -[dashed]-> PRC : (NOT currently supported)\nFuture: CERIF-XML

' --- Datasets from CORA.RDR ---
CORA_RDR --> PRC : Datasets\n(bimonthly automatic harvest)\nRequires ORCID of at least one author

' --- DMPs (now treated as repository → PRC) ---
eiNa --> PRC : DMP metadata\n(ORCID needed for linkage)

' --- Repositories not fully integrated ---
Recercat -[dashed]-> PRC : Possible metadata harvesting\n(currently separate flows)
CORA_TDX -[dashed]-> PRC : Theses\n(harvest depending on policy)

' --- iMarina ↔ CORA.RDR notes ---
iMarina --> CORA_RDR : Optional dataset submission\n(depending on institution policy)

' --- Notes ---
note right of PRC
PRC is NOT a historical database.
Each load replaces the previous state.
Datasets without a matching researcher (ORCID)
are excluded in that cycle.
end note

note bottom of iMarina
Datasets originating from ioChemBD
and stored in iMarina
cannot currently be exported to PRC.
Future integration may support CERIF-XML.
end note

@enduml

